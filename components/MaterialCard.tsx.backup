import { FreeMaterial } from "@/data/free-materials";
import EmailForm from "./EmailForm";

interface MaterialCardProps {
  material: FreeMaterial;
  onEmailSubmit?: (email: string, type: string) => Promise<void>;
  onPurchase?: (productType: string) => Promise<void>;
  isPurchaseLoading?: boolean;
}

export default function MaterialCard({
  material,
  onEmailSubmit,
  onPurchase,
  isPurchaseLoading,
}: MaterialCardProps) {
  const handleEmailSubmit = async (email: string) => {
    if (onEmailSubmit && material.emailType) {
      await onEmailSubmit(email, material.emailType);
    }
  };

  const handlePurchaseClick = async () => {
    if (onPurchase && material.productType) {
      await onPurchase(material.productType);
    }
  };

  return (
    <div className="card-base p-6 lg:p-8 flex flex-col h-full">
      {/* Badge */}
      {material.badge && (
        <div className="mb-2">
          <span className="inline-block px-3 py-1 text-xs font-semibold text-brand-purple bg-brand-purple/10 rounded-full">
            {material.badge}
          </span>
        </div>
      )}

      {/* Title */}
      <h3 className="text-2xl font-bold mb-3">{material.title}</h3>

      {/* Description */}
      <p className="text-gray-600 mb-6 flex-grow">{material.description}</p>

      {/* Price (for purchase type) */}
      {material.type === "purchase" && material.price && (
        <div className="flex items-baseline gap-2 mb-6">
          <span className="text-3xl font-bold text-gray-900">{material.price}</span>
        </div>
      )}

      {/* Action based on type */}
      {material.type === "email-download" && (
        <EmailForm
          placeholder={material.emailPlaceholder || "Your email"}
          buttonText={material.emailButtonText || "Submit"}
          onSubmit={handleEmailSubmit}
        />
      )}

      {material.type === "external-link" && material.url && (
        <a
          href={material.url}
          target="_blank"
          rel="noopener noreferrer"
          className="w-full px-6 py-3 font-semibold text-center text-white bg-brand-purple hover:opacity-90 rounded-lg transition-all"
        >
          {material.linkText || "Learn More"}
        </a>
      )}

      {material.type === "purchase" && (
        <button
          onClick={handlePurchaseClick}
          disabled={isPurchaseLoading}
          className="w-full px-6 py-3 font-semibold text-white bg-brand-purple hover:opacity-90 rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed"
        >
          {isPurchaseLoading ? "Processing..." : "Buy Now"}
        </button>
      )}

      {material.type === "coming-soon" && material.emailType && (
        <EmailForm
          placeholder={material.emailPlaceholder || "Your email"}
          buttonText={material.emailButtonText || "Get Notified"}
          onSubmit={handleEmailSubmit}
        />
      )}
    </div>
  );
}
